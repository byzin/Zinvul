/*!
  \file @kernel_group_name@.hpp
  \author Sho Ikeda

  Copyright (c) 2015-2018 Sho Ikeda
  This software is released under the MIT License.
  http://opensource.org/licenses/mit-license.php
  */

#ifndef ZINVUL_@kernel_group_name@_HPP
#define ZINVUL_@kernel_group_name@_HPP

// Standard C++ library
#include <fstream>
#include <vector>
// Zisc
#include "zisc/error.hpp"
#include "zisc/memory_resource.hpp"
// Zinvul
#include "zinvul/kernel_group.hpp"
#include "zinvul/zinvul_config.hpp"

#ifdef Z_CLANG
#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Wunused-macros"
#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Wreserved-id-macro"
#endif // Z_CLANG

@define_cpp_address_qualifiers_code@

namespace zinvul {

namespace @kernel_group_name@ {

/*!
  */
class KernelGroup : public zinvul::KernelGroup
{
 public:
@kernel_include_lines@

  //! Return the group number
  uint32b getKernelGroupNumber__() const noexcept override
  {
    return @group_number@;
  }

  //! Return the SPIR-V code
  zisc::pmr::vector<char> getKernelSpirvCode__(
      zisc::pmr::memory_resource* mem_resource) const noexcept override
  {
    std::ifstream spirv_file{"@spv_file_path@", std::ios_base::binary};
    ZISC_ASSERT(spirv_file.is_open(), "The SPIR-V file doesn't exist.");
    std::size_t spirv_size = 0;
    {
      const std::size_t begin = spirv_file.tellg();
      spirv_file.seekg(0, std::ios_base::end);
      const std::size_t end = spirv_file.tellg();
      spirv_size = end - begin;
      ZISC_ASSERT((spirv_size % 4) == 0, "The size of the SPIR-V code is invalid.");
      spirv_file.clear();
      spirv_file.seekg(0, std::ios_base::beg);
    }
    zisc::pmr::vector<char> spirv_code{mem_resource};
    spirv_code.resize(spirv_size);
    spirv_file.read(spirv_code.data(), spirv_size);
    return spirv_code;
  }
};

} // namespace @kernel_group_name@

} // namespace zinvul

@undefine_cpp_address_qualifiers_code@

#ifdef Z_CLANG
#pragma clang diagnostic pop
#pragma clang diagnostic pop
#endif // Z_CLANG

#endif // ZINVUL_@kernel_group_name@_HPP
